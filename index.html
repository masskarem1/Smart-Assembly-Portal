<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بوابة الجمعية العمومية الذكية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'IBM Plex Sans Arabic', sans-serif; background-color: #f4f4f7; }
        .swiss-border { border-left: 8px solid #d32f2f; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-2xl mx-auto bg-white shadow-2xl rounded-none overflow-hidden border border-gray-200">
        <div class="bg-black text-white p-8">
            <h1 class="text-3xl font-bold mb-2 uppercase tracking-tighter">Smart Assembly Portal</h1>
            <p class="text-gray-400">إقرار العلم بموعد إنعقاد الجمعية العمومية لعام 2026</p>
        </div>

        <div class="p-8">
            <div class="swiss-border bg-gray-50 p-6 mb-8">
                <h2 class="text-xl font-bold mb-2 text-red-700">تنبيه قانوني هام:</h2>
                <p class="text-sm leading-relaxed text-gray-700">
                    بموجب مسح الـ QR Code وتسجيل بياناتك أدناه، يُعد ذلك إقراراً رسمياً بالعلم بالموعد والمكان وجدول الأعمال، وتُعتبر عضويتك في مجموعة الواتساب وسيلة إخطار قانونية معتمدة.
                </p>
            </div>

            <form id="assemblyForm" class="space-y-6">
                <div>
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-1">الاسم بالكامل (طبقاً لعقد الملكية)</label>
                    <input type="text" name="name" id="userName" required class="w-full border-b-2 border-gray-300 py-2 focus:border-black outline-none transition">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-gray-500 mb-1">رقم الوحدة (شقة/فيلا)</label>
                        <input type="text" name="unit" id="userUnit" required class="w-full border-b-2 border-gray-300 py-2 focus:border-black outline-none transition">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-gray-500 mb-1">رقم الموبايل</label>
                        <input type="tel" name="phone" id="userPhone" required class="w-full border-b-2 border-gray-300 py-2 focus:border-black outline-none transition">
                    </div>
                </div>

                <div class="flex items-center space-x-reverse space-x-3 bg-red-50 p-4 border border-red-100">
                    <input type="checkbox" id="legalConfirm" required class="w-5 h-5 accent-black">
                    <label for="legalConfirm" class="text-sm font-bold text-red-900 leading-tight">
                        أوافق على الانضمام لجروب الواتساب الرسمي وأقر بالعلم بالموعد.
                    </label>
                </div>

                <button type="submit" id="submitBtn" class="w-full bg-black text-white py-4 font-bold hover:bg-gray-800 transition transform active:scale-95">
                    تأكيد العلم والإنضمام للواتساب
                </button>
            </form>

            <hr class="my-10">

            <div class="bg-blue-50 p-6 rounded-lg border border-blue-100">
                <h3 class="font-bold mb-4 flex items-center">
                    <span class="ml-2">✨</span> مساعد الجيران الذكي (Gemini)
                </h3>
                <div id="chatHistory" class="text-sm mb-4 space-y-2 max-h-40 overflow-y-auto"></div>
                <div class="flex gap-2">
                    <input type="text" id="userQuestion" placeholder="اسأل عن جدول الأعمال أو التوكيلات.." class="flex-1 p-2 border rounded-md text-sm outline-none">
                    <button onclick="askGemini()" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm">إرسال</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';
        const GEMINI_KEY = 'YOUR_GEMINI_API_KEY_HERE';

        // 1. Handling Form Submission to Google Sheets
        document.getElementById('assemblyForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.innerText = 'جاري التوثيق...';
            btn.disabled = true;

            const formData = {
                name: document.getElementById('userName').value,
                unit: document.getElementById('userUnit').value,
                phone: document.getElementById('userPhone').value,
                timestamp: new Date().toLocaleString()
            };

            try {
                // إرسال البيانات لجوجل شيت
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(formData)
                });
                
                // التحويل للواتساب بعد النجاح
                window.location.href = "https://chat.whatsapp.com/YOUR_INVITE_LINK_HERE";
            } catch (error) {
                alert('حدث خطأ في التوثيق، حاول مرة أخرى');
                btn.disabled = false;
                btn.innerText = 'تأكيد العلم والإنضمام للواتساب';
            }
        };

        // 2. Gemini API Integration
        async function askGemini() {
            const question = document.getElementById('userQuestion').value;
            if(!question) return;

            const chatHistory = document.getElementById('chatHistory');
            chatHistory.innerHTML += `<p class='text-blue-800 font-bold'>أنت: ${question}</p>`;
            
            // Note: This is a simplified fetch to Gemini API
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_KEY}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: `أنت مساعد ذكي لاتحاد ملاك حي سكني. أجب بجملة قصيرة وودودة: ${question}` }] }] })
                });
                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                chatHistory.innerHTML += `<p class='text-gray-600 italic'>جمناي: ${aiText}</p>`;
                document.getElementById('userQuestion').value = '';
            } catch (e) {
                chatHistory.innerHTML += `<p class='text-red-500'>عذراً، المساعد مشغول حالياً.</p>`;
            }
        }
    </script>
</body>
</html>
